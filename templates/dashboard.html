<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSE Trading Terminal | Professional HFT Platform</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@1.0.1/dist/chartjs-adapter-moment.min.js"></script>
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-tertiary: #1a1a1a;
            --bg-card: #1e1e1e;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --text-muted: #666666;
            --accent-primary: #00d4aa;
            --accent-secondary: #0ea5e9;
            --gain-green: #00ff88;
            --loss-red: #ff4757;
            --warning-orange: #ffa726;
            --border-color: #333333;
            --hover-bg: #2a2a2a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.5;
        }

        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 0.75rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo i {
            color: var(--accent-primary);
            font-size: 1.5rem;
        }

        .logo h1 {
            color: var(--text-primary);
            font-size: 1.25rem;
            font-weight: 700;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .market-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--gain-green);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Main Layout */
        .dashboard {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            grid-template-rows: auto 1fr;
            height: calc(100vh - 60px);
            gap: 1px;
            background: var(--border-color);
        }

        /* Sidebar */
        .sidebar {
            background: var(--bg-secondary);
            overflow-y: auto;
            border-right: 1px solid var(--border-color);
        }

        .nav-section {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .nav-title {
            color: var(--text-muted);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 0.75rem;
            letter-spacing: 0.5px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 0.25rem;
        }

        .nav-item:hover, .nav-item.active {
            background: var(--hover-bg);
            color: var(--accent-primary);
        }

        .nav-item i {
            width: 16px;
            text-align: center;
        }

        /* Watchlist */
        .watchlist {
            flex: 1;
            overflow-y: auto;
        }

        .stock-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .stock-item:hover {
            background: var(--hover-bg);
        }

        .stock-info h4 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .stock-info span {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .stock-price {
            text-align: right;
        }

        .price {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .change {
            font-size: 0.75rem;
            font-weight: 500;
        }

        .gain { color: var(--gain-green); }
        .loss { color: var(--loss-red); }

        /* Main Content */
        .main-content {
            background: var(--bg-primary);
            display: grid;
            grid-template-rows: auto 1fr;
            overflow: hidden;
        }

        /* Market Overview */
        .market-overview {
            background: var(--bg-secondary);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            gap: 2rem;
            overflow-x: auto;
        }

        .index-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            min-width: 180px;
            padding: 0.75rem 1rem;
            background: var(--bg-tertiary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .index-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .nifty { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .sensex { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .banknifty { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }

        .index-info h3 {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .index-value {
            font-size: 1.1rem;
            font-weight: 700;
        }

        /* Chart Area */
        .chart-section {
            padding: 1.5rem 2rem;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            overflow: hidden;
        }

        .chart-container {
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .chart-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .stock-symbol {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stock-exchange {
            font-size: 0.75rem;
            color: var(--text-muted);
            background: var(--bg-tertiary);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }

        .chart-controls {
            display: flex;
            gap: 0.5rem;
        }

        .time-button {
            padding: 0.25rem 0.75rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-secondary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .time-button:hover, .time-button.active {
            background: var(--accent-primary);
            color: var(--bg-primary);
            border-color: var(--accent-primary);
        }

        .export-btn {
            padding: 0.25rem 0.75rem;
            background: var(--warning-orange);
            border: 1px solid var(--warning-orange);
            border-radius: 4px;
            color: var(--bg-primary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-left: 0.5rem;
        }

        .export-btn:hover {
            background: #ff9500;
            transform: translateY(-1px);
        }

        .export-btn i {
            margin-right: 0.25rem;
        }

        .chart-area {
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Order Book */
        .order-book {
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .order-book-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .depth-table {
            height: 350px;
            overflow-y: auto;
        }

        .depth-row {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            padding: 0.5rem 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
        }

        .depth-row:hover {
            background: var(--hover-bg);
        }

        .bid-side {
            color: var(--gain-green);
            text-align: right;
            padding-right: 1rem;
        }

        .ask-side {
            color: var(--loss-red);
            text-align: left;
            padding-left: 1rem;
        }

        .price-center {
            text-align: center;
            color: var(--text-primary);
            font-weight: 600;
        }

        /* Right Panel */
        .right-panel {
            background: var(--bg-secondary);
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--border-color);
        }

        /* Order Entry */
        .order-panel {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .order-tabs {
            display: flex;
            margin-bottom: 1rem;
        }

        .order-tab {
            flex: 1;
            padding: 0.5rem;
            text-align: center;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .order-tab:first-child {
            border-radius: 6px 0 0 6px;
        }

        .order-tab:last-child {
            border-radius: 0 6px 6px 0;
            border-left: none;
        }

        .order-tab.active {
            background: var(--gain-green);
            color: var(--bg-primary);
            border-color: var(--gain-green);
        }

        .order-tab.sell.active {
            background: var(--loss-red);
            border-color: var(--loss-red);
        }

        .order-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input {
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: border-color 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .order-button {
            padding: 0.75rem;
            background: var(--gain-green);
            color: var(--bg-primary);
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .order-button:hover {
            background: #00cc6a;
            transform: translateY(-1px);
        }

        .order-button.sell {
            background: var(--loss-red);
        }

        .order-button.sell:hover {
            background: #e63946;
        }

        /* Portfolio */
        .portfolio-panel {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .portfolio-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .portfolio-value {
            text-align: right;
        }

        .total-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .day-change {
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 0.25rem;
        }

        .position-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .position-info h5 {
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .position-qty {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .position-pnl {
            text-align: right;
        }

        .pnl-value {
            font-size: 0.9rem;
            font-weight: 600;
        }

        .pnl-percent {
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 200px 1fr 280px;
            }
        }

        @media (max-width: 968px) {
            .dashboard {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto 1fr;
            }
            
            .chart-section {
                grid-template-columns: 1fr;
            }
            
            .sidebar, .right-panel {
                display: none;
            }
        }

        /* Loading and Animation */
        .loading {
            opacity: 0.6;
            animation: pulse 1.5s infinite;
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Scrollbars */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo">
            <i class="fas fa-chart-line"></i>
            <h1>NSE Trading Terminal</h1>
        </div>
        
        <div class="header-controls">
            <div class="market-status">
                <div class="status-dot"></div>
                <span>Market Open</span>
                <span style="margin-left: 1rem; font-size: 0.85rem;">09:15 - 15:30 IST</span>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div class="dashboard">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="nav-section">
                <div class="nav-title">Navigation</div>
                <div class="nav-item active">
                    <i class="fas fa-chart-area"></i>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Trading</span>
                </div>
                <div class="nav-item">
                    <i class="fas fa-briefcase"></i>
                    <span>Portfolio</span>
                </div>
                <div class="nav-item">
                    <i class="fas fa-history"></i>
                    <span>Orders</span>
                </div>
                <div class="nav-item">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
            </div>

            <div class="watchlist">
                <div class="nav-section">
                    <div class="nav-title">Watchlist</div>
                </div>
                
                <div class="stock-item" onclick="selectStock('RELIANCE')">
                    <div class="stock-info">
                        <h4>RELIANCE</h4>
                        <span>NSE</span>
                    </div>
                    <div class="stock-price">
                        <div class="price">₹2,847.50</div>
                        <div class="change gain">+1.2%</div>
                    </div>
                </div>

                <div class="stock-item" onclick="selectStock('TCS')">
                    <div class="stock-info">
                        <h4>TCS</h4>
                        <span>NSE</span>
                    </div>
                    <div class="stock-price">
                        <div class="price">₹4,234.80</div>
                        <div class="change loss">-0.8%</div>
                    </div>
                </div>

                <div class="stock-item" onclick="selectStock('HDFCBANK')">
                    <div class="stock-info">
                        <h4>HDFCBANK</h4>
                        <span>NSE</span>
                    </div>
                    <div class="stock-price">
                        <div class="price">₹1,673.25</div>
                        <div class="change gain">+0.5%</div>
                    </div>
                </div>

                <div class="stock-item" onclick="selectStock('INFY')">
                    <div class="stock-info">
                        <h4>INFY</h4>
                        <span>NSE</span>
                    </div>
                    <div class="stock-price">
                        <div class="price">₹1,867.40</div>
                        <div class="change gain">+2.1%</div>
                    </div>
                </div>

                <div class="stock-item" onclick="selectStock('ITC')">
                    <div class="stock-info">
                        <h4>ITC</h4>
                        <span>NSE</span>
                    </div>
                    <div class="stock-price">
                        <div class="price">₹487.60</div>
                        <div class="change loss">-0.3%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Market Overview -->
            <div class="market-overview">
                <div class="index-card">
                    <div class="index-icon nifty">N50</div>
                    <div class="index-info">
                        <h3>NIFTY 50</h3>
                        <div class="index-value gain">25,847.30 <small>+0.8%</small></div>
                    </div>
                </div>

                <div class="index-card">
                    <div class="index-icon sensex">S30</div>
                    <div class="index-info">
                        <h3>SENSEX</h3>
                        <div class="index-value gain">84,923.15 <small>+0.6%</small></div>
                    </div>
                </div>

                <div class="index-card">
                    <div class="index-icon banknifty">BN</div>
                    <div class="index-info">
                        <h3>BANK NIFTY</h3>
                        <div class="index-value loss">51,234.80 <small>-0.2%</small></div>
                    </div>
                </div>
            </div>

            <!-- Chart Section -->
            <div class="chart-section">
                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">
                            <span class="stock-symbol" id="currentSymbol">RELIANCE</span>
                            <span class="stock-exchange">NSE</span>
                        </div>
                        <div class="chart-controls">
                            <button class="time-button" onclick="setTimeframe('1D')">1D</button>
                            <button class="time-button active" onclick="setTimeframe('1W')">1W</button>
                            <button class="time-button" onclick="setTimeframe('1M')">1M</button>
                            <button class="time-button" onclick="setTimeframe('3M')">3M</button>
                            <button class="time-button" onclick="setTimeframe('1Y')">1Y</button>
                            <button class="export-btn" onclick="exportTradesToCSV()" title="Export Trades">
                                <i class="fas fa-download"></i> Trades
                            </button>
                            <button class="export-btn" onclick="exportL2LogsCSV()" title="Export L2 Data">
                                <i class="fas fa-download"></i> L2 Logs
                            </button>
                        </div>
                    </div>
                    <div class="chart-area" id="priceChart">
                        <canvas id="realTimeChart" style="width: 100%; height: 400px;"></canvas>
                    </div>
                </div>

                <div class="order-book">
                    <div class="order-book-header">
                        <h3>Market Depth</h3>
                        <small>Level 2 Order Book</small>
                    </div>
                    <div class="depth-table" id="depthTable">
                        <!-- Order book data will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel">
            <!-- Order Entry -->
            <div class="order-panel">
                <div class="order-tabs">
                    <div class="order-tab active" onclick="setOrderType('buy')">BUY</div>
                    <div class="order-tab sell" onclick="setOrderType('sell')">SELL</div>
                </div>

                <div class="order-form">
                    <div class="form-group">
                        <label class="form-label">Quantity</label>
                        <input type="number" class="form-input" id="orderQty" placeholder="0" value="1">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Price</label>
                        <input type="number" class="form-input" id="orderPrice" placeholder="Market Price" step="0.05">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Order Type</label>
                        <select class="form-input" id="orderTypeSelect">
                            <option value="LIMIT">Limit Order</option>
                            <option value="MARKET">Market Order</option>
                            <option value="SL">Stop Loss</option>
                            <option value="SL-M">Stop Loss Market</option>
                        </select>
                    </div>

                    <button class="order-button" id="orderButton" onclick="placeOrder()">
                        PLACE BUY ORDER
                    </button>
                </div>
            </div>

            <!-- Portfolio -->
            <div class="portfolio-panel">
                <div class="portfolio-header">
                    <h3>Portfolio</h3>
                    <div class="portfolio-value">
                        <div class="total-value">₹2,45,678</div>
                        <div class="day-change gain">+₹3,456 (+1.4%)</div>
                    </div>
                </div>

                <div class="position-item">
                    <div class="position-info">
                        <h5>RELIANCE</h5>
                        <div class="position-qty">25 shares</div>
                    </div>
                    <div class="position-pnl">
                        <div class="pnl-value gain">+₹1,250</div>
                        <div class="pnl-percent gain">+1.8%</div>
                    </div>
                </div>

                <div class="position-item">
                    <div class="position-info">
                        <h5>TCS</h5>
                        <div class="position-qty">15 shares</div>
                    </div>
                    <div class="position-pnl">
                        <div class="pnl-value loss">-₹850</div>
                        <div class="pnl-percent loss">-1.3%</div>
                    </div>
                </div>

                <div class="position-item">
                    <div class="position-info">
                        <h5>HDFCBANK</h5>
                        <div class="position-qty">30 shares</div>
                    </div>
                    <div class="position-pnl">
                        <div class="pnl-value gain">+₹750</div>
                        <div class="pnl-percent gain">+1.5%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentSymbol = 'RELIANCE';
        let orderType = 'buy';
        let isMarketOpen = true;

        // Real-time chart variables
        let realtimeChart;
        let chartData = [];
        let chartLabels = [];
        const maxDataPoints = 100;

        // Initialize real-time chart
        function initRealtimeChart() {
            const ctx = document.getElementById('realTimeChart').getContext('2d');
            
            realtimeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: 'Price',
                        data: chartData,
                        borderColor: '#00d4aa',
                        backgroundColor: 'rgba(0, 212, 170, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'minute',
                                displayFormats: {
                                    minute: 'HH:mm'
                                }
                            },
                            ticks: {
                                color: '#666666',
                                maxTicksLimit: 10
                            },
                            grid: {
                                color: '#333333'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#666666',
                                callback: function(value) {
                                    return '₹' + value.toFixed(2);
                                }
                            },
                            grid: {
                                color: '#333333'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    animation: false
                }
            });
        }

        // Simulate real-time price data
        function generateRealtimePrice() {
            const basePrices = {
                'RELIANCE': 2850.0,
                'TCS': 4200.0,
                'HDFCBANK': 1670.0,
                'INFY': 1860.0,
                'ITC': 485.0,
                'BITCOIN': 43250.0,
                'ETHEREUM': 2567.8
            };
            
            const basePrice = basePrices[currentSymbol] || 1000;
            
            // Generate realistic price movement
            if (chartData.length === 0) {
                chartData.push(basePrice);
            } else {
                const lastPrice = chartData[chartData.length - 1];
                const volatility = 0.002; // 0.2% volatility
                const randomWalk = (Math.random() - 0.5) * 2 * volatility;
                const meanReversion = (basePrice - lastPrice) * 0.001;
                const newPrice = lastPrice * (1 + randomWalk + meanReversion);
                chartData.push(newPrice);
            }
            
            // Add timestamp
            chartLabels.push(new Date());
            
            // Keep only last 100 points
            if (chartData.length > maxDataPoints) {
                chartData.shift();
                chartLabels.shift();
            }
            
            // Update chart
            if (realtimeChart) {
                realtimeChart.update('none');
            }
            
            // Update current price display
            const currentPrice = chartData[chartData.length - 1];
            document.getElementById('orderPrice').value = currentPrice.toFixed(2);
            updateOrderBook();
        }

        // CSV Export functionality
        function exportTradesToCSV() {
            const trades = [
                ['Timestamp', 'Symbol', 'Side', 'Quantity', 'Price', 'Total', 'Status'],
                [new Date().toISOString(), currentSymbol, 'BUY', '100', '2850.50', '285050', 'FILLED'],
                [new Date().toISOString(), currentSymbol, 'SELL', '50', '2851.25', '142562.50', 'FILLED'],
                [new Date().toISOString(), currentSymbol, 'BUY', '200', '2849.75', '569950', 'PARTIAL']
            ];
            
            const csvContent = trades.map(row => row.join(',')).join('\n');
            downloadCSV(csvContent, 'trades_export.csv');
        }

        function exportL2LogsCSV() {
            const l2Data = [
                ['Timestamp', 'Symbol', 'Bid_Price', 'Bid_Qty', 'Ask_Price', 'Ask_Qty', 'Spread'],
                [new Date().toISOString(), currentSymbol, '2849.95', '500', '2850.05', '300', '0.10'],
                [new Date().toISOString(), currentSymbol, '2849.90', '750', '2850.10', '400', '0.20'],
                [new Date().toISOString(), currentSymbol, '2849.85', '200', '2850.15', '600', '0.30']
            ];
            
            const csvContent = l2Data.map(row => row.join(',')).join('\n');
            downloadCSV(csvContent, 'l2_logs_export.csv');
        }

        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            updateOrderBook();
            initRealtimeChart();
            startRealTimeUpdates();
            
            // Start real-time price simulation
            setInterval(generateRealtimePrice, 1000); // Update every second
        });

        // Stock selection
        function selectStock(symbol) {
            currentSymbol = symbol;
            document.getElementById('currentSymbol').textContent = symbol;
            
            // Update price in order form
            const prices = {
                'RELIANCE': 2847.50,
                'TCS': 4234.80,
                'HDFCBANK': 1673.25,
                'INFY': 1867.40,
                'ITC': 487.60
            };
            
            document.getElementById('orderPrice').value = prices[symbol] || 1000;
            updateOrderBook();
            
            // Highlight selected stock
            document.querySelectorAll('.stock-item').forEach(item => {
                item.style.background = '';
            });
            event.target.closest('.stock-item').style.background = 'var(--hover-bg)';
        }

        // Order type switching
        function setOrderType(type) {
            orderType = type;
            const tabs = document.querySelectorAll('.order-tab');
            const button = document.getElementById('orderButton');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            
            if (type === 'buy') {
                tabs[0].classList.add('active');
                button.textContent = 'PLACE BUY ORDER';
                button.className = 'order-button';
            } else {
                tabs[1].classList.add('active');
                button.textContent = 'PLACE SELL ORDER';
                button.className = 'order-button sell';
            }
        }

        // Place order
        function placeOrder() {
            const qty = document.getElementById('orderQty').value;
            const price = document.getElementById('orderPrice').value;
            const type = document.getElementById('orderTypeSelect').value;
            
            if (!qty || !price) {
                alert('Please enter quantity and price');
                return;
            }
            
            // Simulate order placement
            alert(`${orderType.toUpperCase()} order placed:\nSymbol: ${currentSymbol}\nQuantity: ${qty}\nPrice: ₹${price}\nType: ${type}`);
            
            // Reset form
            document.getElementById('orderQty').value = '1';
        }

        // Update order book
        function updateOrderBook() {
            const depthTable = document.getElementById('depthTable');
            const basePrice = parseFloat(document.getElementById('orderPrice').value) || 1000;
            
            let html = '';
            
            // Generate realistic order book data
            for (let i = 5; i >= 1; i--) {
                const askPrice = basePrice + (i * 0.05);
                const askQty = Math.floor(Math.random() * 1000) + 100;
                
                html += `
                    <div class="depth-row">
                        <div class="bid-side"></div>
                        <div class="price-center">₹${askPrice.toFixed(2)}</div>
                        <div class="ask-side">${askQty}</div>
                    </div>
                `;
            }
            
            // Current price row
            html += `
                <div class="depth-row" style="background: rgba(0, 212, 170, 0.1);">
                    <div class="bid-side"></div>
                    <div class="price-center" style="color: var(--accent-primary); font-weight: bold;">₹${basePrice.toFixed(2)}</div>
                    <div class="ask-side"></div>
                </div>
            `;
            
            for (let i = 1; i <= 5; i++) {
                const bidPrice = basePrice - (i * 0.05);
                const bidQty = Math.floor(Math.random() * 1000) + 100;
                
                html += `
                    <div class="depth-row">
                        <div class="bid-side">${bidQty}</div>
                        <div class="price-center">₹${bidPrice.toFixed(2)}</div>
                        <div class="ask-side"></div>
                    </div>
                `;
            }
            
            depthTable.innerHTML = html;
        }

        // Timeframe selection
        function setTimeframe(period) {
            document.querySelectorAll('.time-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update chart based on timeframe
            console.log(`Loading ${period} chart for ${currentSymbol}`);
        }

        // Real-time updates simulation
        function startRealTimeUpdates() {
            setInterval(() => {
                // Simulate price updates
                const priceElements = document.querySelectorAll('.price');
                priceElements.forEach(el => {
                    const currentPrice = parseFloat(el.textContent.replace('₹', '').replace(',', ''));
                    const change = (Math.random() - 0.5) * 10; // Random change up to ±5
                    const newPrice = Math.max(1, currentPrice + change);
                    el.textContent = `₹${newPrice.toFixed(2)}`;
                });
                
                // Update order book
                if (Math.random() > 0.7) { // 30% chance to update order book
                    updateOrderBook();
                }
            }, 2000);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case 'b':
                        e.preventDefault();
                        setOrderType('buy');
                        document.getElementById('orderQty').focus();
                        break;
                    case 's':
                        e.preventDefault();
                        setOrderType('sell');
                        document.getElementById('orderQty').focus();
                        break;
                    case 'Enter':
                        if (e.target.classList.contains('form-input')) {
                            e.preventDefault();
                            placeOrder();
                        }
                        break;
                }
            }
        });
    </script>
</body>
</html>
